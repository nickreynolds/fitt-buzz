# Migration `20201102001558-add-recording-models-first-pass`

This migration has been generated by Nick Reynolds at 11/1/2020, 7:15:58 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "public"."RoutineRevisionRecording" (
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
"createdById" text  NOT NULL ,
"id" text  NOT NULL ,
"routineRevisionId" text  NOT NULL ,
PRIMARY KEY ("id"))

CREATE TABLE "public"."SetGroupRecording" (
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
"createdById" text  NOT NULL ,
"id" text  NOT NULL ,
"setGroupId" text  NOT NULL ,
PRIMARY KEY ("id"))

CREATE TABLE "public"."SetRecording" (
"id" text  NOT NULL ,
"setGroupRecordingId" text  NOT NULL ,
PRIMARY KEY ("id"))

CREATE TABLE "public"."ExerciseRecording" (
"id" text  NOT NULL ,
"exerciseId" text  NOT NULL ,
"setRecordingId" text   ,
PRIMARY KEY ("id"))

CREATE TABLE "public"."MeasurableRecording" (
"id" text  NOT NULL ,
"value" text  NOT NULL ,
"exerciseRecordingId" text   ,
"measurableId" text  NOT NULL ,
PRIMARY KEY ("id"))

ALTER TABLE "public"."RoutineRevisionRecording" ADD FOREIGN KEY ("createdById")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."RoutineRevisionRecording" ADD FOREIGN KEY ("routineRevisionId")REFERENCES "public"."RoutineRevision"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."SetGroupRecording" ADD FOREIGN KEY ("createdById")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."SetGroupRecording" ADD FOREIGN KEY ("setGroupId")REFERENCES "public"."SetGroup"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."SetRecording" ADD FOREIGN KEY ("setGroupRecordingId")REFERENCES "public"."SetGroupRecording"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."ExerciseRecording" ADD FOREIGN KEY ("exerciseId")REFERENCES "public"."Exercise"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."ExerciseRecording" ADD FOREIGN KEY ("setRecordingId")REFERENCES "public"."SetRecording"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."MeasurableRecording" ADD FOREIGN KEY ("measurableId")REFERENCES "public"."Measurable"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."MeasurableRecording" ADD FOREIGN KEY ("exerciseRecordingId")REFERENCES "public"."ExerciseRecording"("id") ON DELETE SET NULL ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20201101222950-not-sure..20201102001558-add-recording-models-first-pass
--- datamodel.dml
+++ datamodel.dml
@@ -4,22 +4,23 @@
 ///
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
 model Exercise {
-  createdAt     DateTime       @default(now())
-  createdById   String?
-  description   String
-  formatId      String
-  id            String         @id
-  name          String
-  createdBy     User?          @relation(fields: [createdById], references: [id])
-  format        Format         @relation(fields: [formatId], references: [id])
-  muscleImpacts MuscleImpact[]
-  setGroups     SetGroup[]
+  createdAt         DateTime            @default(now())
+  createdById       String?
+  description       String
+  formatId          String
+  id                String              @id
+  name              String
+  createdBy         User?               @relation(fields: [createdById], references: [id])
+  format            Format              @relation(fields: [formatId], references: [id])
+  muscleImpacts     MuscleImpact[]
+  setGroups         SetGroup[]
+  ExerciseRecording ExerciseRecording[]
 }
 model SetGroup {
   createdAt         DateTime            @default(now())
@@ -28,8 +29,9 @@
   createdBy         User?               @relation(fields: [createdById], references: [id])
   exercises         Exercise[] // usually will just have 1, but could have multiple to create "super sets"
   defaultNumSets    Int
   SetGroupPlacement SetGroupPlacement[]
+  SetGroupRecording SetGroupRecording[]
 }
 model SetGroupPlacement {
   createdAt        DateTime          @default(now())
@@ -42,28 +44,62 @@
   setGroupId       String
 }
 model RoutineRevision {
-  createdAt          DateTime            @default(now())
-  createdById        String?
-  id                 String              @id
-  createdBy          User?               @relation(fields: [createdById], references: [id])
-  setGroupPlacements SetGroupPlacement[]
-  Routine            Routine?            @relation(fields: [routineId], references: [id])
-  routineId          String?
+  createdAt                DateTime                   @default(now())
+  createdById              String?
+  id                       String                     @id
+  createdBy                User?                      @relation(fields: [createdById], references: [id])
+  setGroupPlacements       SetGroupPlacement[]
+  Routine                  Routine?                   @relation(fields: [routineId], references: [id])
+  routineId                String?
+  RoutineRevisionRecording RoutineRevisionRecording[]
 }
-// model RoutineRevisionRecording {
-//   createdAt   DateTime @default(now())
-//   createdById String
-//   id          String   @id
-//   createdBy   User     @relation(fields: [createdById], references: [id])
-// }
+model RoutineRevisionRecording {
+  createdAt         DateTime        @default(now())
+  createdById       String
+  id                String          @id
+  createdBy         User            @relation(fields: [createdById], references: [id])
+  revision          RoutineRevision @relation(fields: [routineRevisionId], references: [id])
+  routineRevisionId String
+}
-// model SetGroupRecording {
+model SetGroupRecording {
+  createdAt    DateTime       @default(now())
+  createdById  String
+  id           String         @id
+  createdBy    User           @relation(fields: [createdById], references: [id])
+  setGroup     SetGroup       @relation(fields: [setGroupId], references: [id])
+  setGroupId   String
+  SetRecording SetRecording[]
+}
-// }
+model SetRecording {
+  id                  String              @id
+  setGroupRecording   SetGroupRecording   @relation(fields: [setGroupRecordingId], references: [id])
+  setGroupRecordingId String
+  exericseRecordings  ExerciseRecording[]
+}
+model ExerciseRecording {
+  id                   String                @id
+  exercise             Exercise              @relation(fields: [exerciseId], references: [id])
+  measurableRecordings MeasurableRecording[]
+  exerciseId           String
+  SetRecording         SetRecording?         @relation(fields: [setRecordingId], references: [id])
+  setRecordingId       String?
+}
+
+model MeasurableRecording {
+  id                  String             @id
+  measurable          Measurable         @relation(fields: [measurableId], references: [id])
+  value               String
+  ExerciseRecording   ExerciseRecording? @relation(fields: [exerciseRecordingId], references: [id])
+  exerciseRecordingId String?
+  measurableId        String
+}
+
 model Routine {
   createdAt        DateTime          @default(now())
   createdById      String?
   id               String            @id
@@ -85,11 +121,12 @@
   measurables Measurable[]
 }
 model Measurable {
-  id      String   @id
-  name    String
-  formats Format[]
+  id                  String                @id
+  name                String
+  formats             Format[]
+  MeasurableRecording MeasurableRecording[]
 }
 model Muscle {
   createdAt     DateTime       @default(now())
@@ -107,13 +144,15 @@
   exercises    Exercise[]
 }
 model User {
-  id                String              @id
-  password          String
-  username          String              @unique
-  exercises         Exercise[]
-  setGroups         SetGroup[]
-  routineRevisions  RoutineRevision[]
-  routines          Routine[]
-  SetGroupPlacement SetGroupPlacement[]
+  id                       String                     @id
+  password                 String
+  username                 String                     @unique
+  exercises                Exercise[]
+  setGroups                SetGroup[]
+  routineRevisions         RoutineRevision[]
+  routines                 Routine[]
+  SetGroupPlacement        SetGroupPlacement[]
+  RoutineRevisionRecording RoutineRevisionRecording[]
+  SetGroupRecording        SetGroupRecording[]
 }
```


