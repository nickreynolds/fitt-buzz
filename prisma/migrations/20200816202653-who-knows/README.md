# Migration `20200816202653-who-knows`

This migration has been generated by Nick Reynolds at 8/16/2020, 4:26:53 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "public"."Exercise" (
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
"createdById" text   ,
"description" text  NOT NULL ,
"formatId" text  NOT NULL ,
"id" text  NOT NULL ,
"name" text  NOT NULL ,
PRIMARY KEY ("id"))

CREATE TABLE "public"."Format" (
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
"description" text  NOT NULL ,
"id" text  NOT NULL ,
"name" text  NOT NULL ,
PRIMARY KEY ("id"))

CREATE TABLE "public"."Measurable" (
"id" text  NOT NULL ,
"name" text  NOT NULL ,
PRIMARY KEY ("id"))

CREATE TABLE "public"."MeasurablesOnFormats" (
"formatId" text  NOT NULL ,
"measurableId" text  NOT NULL ,
PRIMARY KEY ("formatId","measurableId"))

CREATE TABLE "public"."Muscle" (
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
"description" text  NOT NULL ,
"id" text  NOT NULL ,
"name" text  NOT NULL ,
PRIMARY KEY ("id"))

CREATE TABLE "public"."MuscleImpact" (
"id" text  NOT NULL ,
"impactRating" integer  NOT NULL ,
"muscleId" text  NOT NULL ,
PRIMARY KEY ("id"))

CREATE TABLE "public"."Routine" (
"color" text  NOT NULL ,
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
"createdById" text  NOT NULL ,
"description" text  NOT NULL ,
"id" text  NOT NULL ,
"name" text  NOT NULL ,
PRIMARY KEY ("id"))

CREATE TABLE "public"."RoutineRevision" (
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
"createdById" text  NOT NULL ,
"id" text  NOT NULL ,
"routineBlob" text  NOT NULL ,
"routineId" text   ,
PRIMARY KEY ("id"))

CREATE TABLE "public"."Set" (
"createdById" text  NOT NULL ,
"exerciseId" text  NOT NULL ,
"id" text  NOT NULL ,
"restSeconds" integer  NOT NULL ,
PRIMARY KEY ("id"))

CREATE TABLE "public"."SetGroup" (
"createdById" text  NOT NULL ,
"id" text  NOT NULL ,
PRIMARY KEY ("id"))

CREATE TABLE "public"."User" (
"id" text  NOT NULL ,
"password" text  NOT NULL ,
"username" text  NOT NULL ,
PRIMARY KEY ("id"))

CREATE TABLE "public"."_ExerciseToMuscleImpact" (
"A" text  NOT NULL ,
"B" text  NOT NULL )

CREATE TABLE "public"."_RoutineRevisionToSetGroup" (
"A" text  NOT NULL ,
"B" text  NOT NULL )

CREATE TABLE "public"."_SetToSetGroup" (
"A" text  NOT NULL ,
"B" text  NOT NULL )

CREATE UNIQUE INDEX "User.username_unique" ON "public"."User"("username")

CREATE UNIQUE INDEX "_ExerciseToMuscleImpact_AB_unique" ON "public"."_ExerciseToMuscleImpact"("A","B")

CREATE  INDEX "_ExerciseToMuscleImpact_B_index" ON "public"."_ExerciseToMuscleImpact"("B")

CREATE UNIQUE INDEX "_RoutineRevisionToSetGroup_AB_unique" ON "public"."_RoutineRevisionToSetGroup"("A","B")

CREATE  INDEX "_RoutineRevisionToSetGroup_B_index" ON "public"."_RoutineRevisionToSetGroup"("B")

CREATE UNIQUE INDEX "_SetToSetGroup_AB_unique" ON "public"."_SetToSetGroup"("A","B")

CREATE  INDEX "_SetToSetGroup_B_index" ON "public"."_SetToSetGroup"("B")

ALTER TABLE "public"."Exercise" ADD FOREIGN KEY ("createdById")REFERENCES "public"."User"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."Exercise" ADD FOREIGN KEY ("formatId")REFERENCES "public"."Format"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."MeasurablesOnFormats" ADD FOREIGN KEY ("formatId")REFERENCES "public"."Format"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."MeasurablesOnFormats" ADD FOREIGN KEY ("measurableId")REFERENCES "public"."Measurable"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."MuscleImpact" ADD FOREIGN KEY ("muscleId")REFERENCES "public"."Muscle"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Routine" ADD FOREIGN KEY ("createdById")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."RoutineRevision" ADD FOREIGN KEY ("createdById")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."RoutineRevision" ADD FOREIGN KEY ("routineId")REFERENCES "public"."Routine"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."Set" ADD FOREIGN KEY ("createdById")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Set" ADD FOREIGN KEY ("exerciseId")REFERENCES "public"."Exercise"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."SetGroup" ADD FOREIGN KEY ("createdById")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."_ExerciseToMuscleImpact" ADD FOREIGN KEY ("A")REFERENCES "public"."Exercise"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."_ExerciseToMuscleImpact" ADD FOREIGN KEY ("B")REFERENCES "public"."MuscleImpact"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."_RoutineRevisionToSetGroup" ADD FOREIGN KEY ("A")REFERENCES "public"."RoutineRevision"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."_RoutineRevisionToSetGroup" ADD FOREIGN KEY ("B")REFERENCES "public"."SetGroup"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."_SetToSetGroup" ADD FOREIGN KEY ("A")REFERENCES "public"."Set"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."_SetToSetGroup" ADD FOREIGN KEY ("B")REFERENCES "public"."SetGroup"("id") ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200816200929-after-introspect..20200816202653-who-knows
--- datamodel.dml
+++ datamodel.dml
@@ -1,12 +1,12 @@
 generator client {
   provider = "prisma-client-js"
 }
-/// 
+///
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
 model Exercise {
   createdAt    DateTime       @default(now())
@@ -21,22 +21,30 @@
   MuscleImpact MuscleImpact[]
 }
 model Format {
-  createdAt   DateTime     @default(now())
+  createdAt   DateTime               @default(now())
   description String
-  id          String       @id
+  id          String                 @id
   name        String
   Exercise    Exercise[]
-  Measurable  Measurable[]
+  measurables MeasurablesOnFormats[]
 }
 model Measurable {
-  id     String   @id
-  name   String
-  Format Format[]
+  id      String                 @id
+  name    String
+  formats MeasurablesOnFormats[]
 }
+model MeasurablesOnFormats {
+  format       Format     @relation(fields: [formatId], references: [id])
+  formatId     String
+  measurable   Measurable @relation(fields: [measurableId], references: [id])
+  measurableId String
+  @@id([formatId, measurableId])
+}
+
 model Muscle {
   createdAt    DateTime       @default(now())
   description  String
   id           String         @id
```


