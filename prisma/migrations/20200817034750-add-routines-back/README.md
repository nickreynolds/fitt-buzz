# Migration `20200817034750-add-routines-back`

This migration has been generated by Nick Reynolds at 8/16/2020, 11:47:50 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "public"."SetGroup" (
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
"createdById" text   ,
"id" text  NOT NULL ,
"defaultNumSets" integer  NOT NULL ,
PRIMARY KEY ("id"))

CREATE TABLE "public"."RoutineRevision" (
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
"createdById" text   ,
"id" text  NOT NULL ,
"routineId" text   ,
PRIMARY KEY ("id"))

CREATE TABLE "public"."Routine" (
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
"createdById" text   ,
"id" text  NOT NULL ,
"name" text  NOT NULL ,
"description" text  NOT NULL ,
PRIMARY KEY ("id"))

CREATE TABLE "public"."_ExerciseToSetGroup" (
"A" text  NOT NULL ,
"B" text  NOT NULL )

CREATE TABLE "public"."_RoutineRevisionToSetGroup" (
"A" text  NOT NULL ,
"B" text  NOT NULL )

CREATE UNIQUE INDEX "_ExerciseToSetGroup_AB_unique" ON "public"."_ExerciseToSetGroup"("A","B")

CREATE  INDEX "_ExerciseToSetGroup_B_index" ON "public"."_ExerciseToSetGroup"("B")

CREATE UNIQUE INDEX "_RoutineRevisionToSetGroup_AB_unique" ON "public"."_RoutineRevisionToSetGroup"("A","B")

CREATE  INDEX "_RoutineRevisionToSetGroup_B_index" ON "public"."_RoutineRevisionToSetGroup"("B")

ALTER TABLE "public"."SetGroup" ADD FOREIGN KEY ("createdById")REFERENCES "public"."User"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."RoutineRevision" ADD FOREIGN KEY ("createdById")REFERENCES "public"."User"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."RoutineRevision" ADD FOREIGN KEY ("routineId")REFERENCES "public"."Routine"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."Routine" ADD FOREIGN KEY ("createdById")REFERENCES "public"."User"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."_ExerciseToSetGroup" ADD FOREIGN KEY ("A")REFERENCES "public"."Exercise"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."_ExerciseToSetGroup" ADD FOREIGN KEY ("B")REFERENCES "public"."SetGroup"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."_RoutineRevisionToSetGroup" ADD FOREIGN KEY ("A")REFERENCES "public"."RoutineRevision"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."_RoutineRevisionToSetGroup" ADD FOREIGN KEY ("B")REFERENCES "public"."SetGroup"("id") ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200816205213-try-implicit-again..20200817034750-add-routines-back
--- datamodel.dml
+++ datamodel.dml
@@ -4,9 +4,9 @@
 ///
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
 model Exercise {
   createdAt     DateTime       @default(now())
@@ -17,10 +17,41 @@
   name          String
   User          User?          @relation(fields: [createdById], references: [id])
   format        Format         @relation(fields: [formatId], references: [id])
   muscleImpacts MuscleImpact[]
+  setGroups     SetGroup[]
 }
+model SetGroup {
+  createdAt        DateTime          @default(now())
+  createdById      String?
+  id               String            @id
+  User             User?             @relation(fields: [createdById], references: [id])
+  exercises        Exercise[] // usually will just have 1, but could have multiple to create "super sets"
+  defaultNumSets   Int
+  routineRevisions RoutineRevision[]
+}
+
+model RoutineRevision {
+  createdAt   DateTime   @default(now())
+  createdById String?
+  id          String     @id
+  User        User?      @relation(fields: [createdById], references: [id])
+  setGroups   SetGroup[]
+  Routine     Routine?   @relation(fields: [routineId], references: [id])
+  routineId   String?
+}
+
+model Routine {
+  createdAt   DateTime          @default(now())
+  createdById String?
+  id          String            @id
+  User        User?             @relation(fields: [createdById], references: [id])
+  revisions   RoutineRevision[]
+  name        String
+  description String
+}
+
 model Format {
   createdAt   DateTime     @default(now())
   description String
   id          String       @id
@@ -51,9 +82,12 @@
   exercises    Exercise[]
 }
 model User {
-  id       String     @id
-  password String
-  username String     @unique
-  Exercise Exercise[]
+  id              String            @id
+  password        String
+  username        String            @unique
+  Exercise        Exercise[]
+  SetGroup        SetGroup[]
+  RoutineRevision RoutineRevision[]
+  Routine         Routine[]
 }
```


