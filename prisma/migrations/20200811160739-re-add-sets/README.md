# Migration `20200811160739-re-add-sets`

This migration has been generated by Nick Reynolds at 8/11/2020, 4:07:39 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "public"."Set" (
"exerciseId" integer  NOT NULL ,"id" SERIAL,"restSeconds" integer  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."SetGroup" (
"id" SERIAL,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."_SetToSetGroup" (
"A" integer  NOT NULL ,"B" integer  NOT NULL )

CREATE TABLE "public"."_RoutineRevisionToSetGroup" (
"A" integer  NOT NULL ,"B" integer  NOT NULL )

CREATE UNIQUE INDEX "_SetToSetGroup_AB_unique" ON "public"."_SetToSetGroup"("A","B")

CREATE  INDEX "_SetToSetGroup_B_index" ON "public"."_SetToSetGroup"("B")

CREATE UNIQUE INDEX "_RoutineRevisionToSetGroup_AB_unique" ON "public"."_RoutineRevisionToSetGroup"("A","B")

CREATE  INDEX "_RoutineRevisionToSetGroup_B_index" ON "public"."_RoutineRevisionToSetGroup"("B")

ALTER TABLE "public"."Set" ADD FOREIGN KEY ("exerciseId")REFERENCES "public"."Exercise"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."_SetToSetGroup" ADD FOREIGN KEY ("A")REFERENCES "public"."Set"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."_SetToSetGroup" ADD FOREIGN KEY ("B")REFERENCES "public"."SetGroup"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."_RoutineRevisionToSetGroup" ADD FOREIGN KEY ("A")REFERENCES "public"."RoutineRevision"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."_RoutineRevisionToSetGroup" ADD FOREIGN KEY ("B")REFERENCES "public"."SetGroup"("id") ON DELETE CASCADE  ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200810183112-simplify-routine..20200811160739-re-add-sets
--- datamodel.dml
+++ datamodel.dml
@@ -1,8 +1,8 @@
 // 1
 datasource db {
     provider = "postgresql"
-    url = "***"
+    url = "***"
 }
 // 2
 generator client {
@@ -18,15 +18,31 @@
     description String
     format      String
     postedBy    User     @relation(fields: [postedById], references: [id])
     postedById  Int
+    sets        Set[]
 }
+model Set {
+    id          Int        @id @default(autoincrement())
+    exercise    Exercise   @relation(fields: [exerciseId], references: [id])
+    restSeconds Int
+    exerciseId  Int
+    setGroups   SetGroup[]
+}
+
+model SetGroup {
+    id               Int               @id @default(autoincrement())
+    sets             Set[]
+    routineRevisions RoutineRevision[]
+}
+
 model RoutineRevision {
-    id          Int      @id @default(autoincrement())
-    createdAt   DateTime @default(now())
+    id          Int        @id @default(autoincrement())
+    createdAt   DateTime   @default(now())
     routineBlob String
-    Routine     Routine? @relation(fields: [routineId], references: [id])
+    setGroups   SetGroup[]
+    Routine     Routine?   @relation(fields: [routineId], references: [id])
     routineId   Int?
 }
 model Routine {
```


