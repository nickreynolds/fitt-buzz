# Migration `20200810183112-simplify-routine`

This migration has been generated by Nick Reynolds at 8/10/2020, 6:31:12 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "public"."RoutineRevision" (
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"id" SERIAL,"routineBlob" text  NOT NULL ,"routineId" integer   ,
    PRIMARY KEY ("id"))

ALTER TABLE "public"."Exercise" DROP CONSTRAINT IF EXiSTS "Exercise_postedById_fkey",
ALTER COLUMN "postedById" SET NOT NULL;

ALTER TABLE "public"."Routine" DROP CONSTRAINT IF EXiSTS "Routine_postedById_fkey",
ALTER COLUMN "postedById" SET NOT NULL;

ALTER TABLE "public"."Set" DROP CONSTRAINT IF EXiSTS "Set_exerciseId_fkey";

ALTER TABLE "public"."Set" DROP CONSTRAINT IF EXiSTS "Set_routineId_fkey";

ALTER TABLE "public"."RoutineRevision" ADD FOREIGN KEY ("routineId")REFERENCES "public"."Routine"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."Exercise" ADD FOREIGN KEY ("postedById")REFERENCES "public"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Routine" ADD FOREIGN KEY ("postedById")REFERENCES "public"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE

DROP TABLE "public"."Set";
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200810000344-add-sets..20200810183112-simplify-routine
--- datamodel.dml
+++ datamodel.dml
@@ -1,8 +1,8 @@
 // 1
 datasource db {
     provider = "postgresql"
-    url = "***"
+    url = "***"
 }
 // 2
 generator client {
@@ -16,33 +16,29 @@
     createdAt   DateTime @default(now())
     name        String
     description String
     format      String
-    postedBy    User?    @relation(fields: [postedById], references: [id])
-    postedById  Int?
-    Set         Set[]
+    postedBy    User     @relation(fields: [postedById], references: [id])
+    postedById  Int
 }
-model Set {
+model RoutineRevision {
     id          Int      @id @default(autoincrement())
     createdAt   DateTime @default(now())
-    exercise    Exercise @relation(fields: [exerciseId], references: [id])
-    repetitions Int
-    restSeconds Int
-    exerciseId  Int
+    routineBlob String
     Routine     Routine? @relation(fields: [routineId], references: [id])
     routineId   Int?
 }
 model Routine {
-    id          Int      @id @default(autoincrement())
-    createdAt   DateTime @default(now())
+    id          Int               @id @default(autoincrement())
+    createdAt   DateTime          @default(now())
     name        String
     description String
     color       String
-    postedBy    User?    @relation(fields: [postedById], references: [id])
-    postedById  Int?
-    sets        Set[]
+    postedBy    User              @relation(fields: [postedById], references: [id])
+    postedById  Int
+    revisions   RoutineRevision[]
 }
 model User {
     id        Int        @id @default(autoincrement())
```


